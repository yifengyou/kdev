#cloud-config
autoinstall:
  version: 1
  automatic:
    reboot: true
    updates: false
    upgrade: false
  console: |
    type=serial
    rich-mode=true
  refresh-installer:
    update: false
  apt:
    disable_components: []
    geoip: true
    preserve_sources_list: false
    primary:
    - arches:
      - amd64
      uri: https://mirrors.aliyun.com/ubuntu
    - arches:
      - arm64
      uri: http://mirrors.aliyun.com/ubuntu-ports
  identity:
    hostname: ubuntu2204
    password: $6$le8Tsrwn14s46Axh$tD2pc/OSVm5Y85179nb7Uy9cioKP6UGEkIQ.cWXOiiAIVF3n/jBJwAap14S9msBJM.ciCXG4LOe27Lb2dE.zA1
    realname: ubuntu
    username: ubuntu
  user-data:
    disable_root: false
    chpasswd:
      list: |
        root:linux
      expire: false
  kernel:
    package: linux-generic
    cmdline: cloud-init=disabled
  keyboard:
    layout: us
    toggle: null
    variant: ''
  locale: en_US.UTF-8
  timezone: Asia/Shanghai
  network:
    ethernets:
      enp1s0:
        dhcp4: true
    version: 2
  ssh:
    allow-pw: true
    authorized-keys: []
    install-server: true
  packages:
    - vim
  storage:
    layout:
      name: direct
  grub:
    install_devices:
      - /dev/sda
  late-commands:
    - sed -i -e 's/^#\?PasswordAuthentication.*/PasswordAuthentication yes/g' /target/etc/ssh/sshd_config
    - touch /target/etc/cloud/cloud-init.disabled